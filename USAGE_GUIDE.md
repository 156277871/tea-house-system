# 连锁茶楼管理系统 - 使用指南

## 快速体验（3步启动）

### 第1步：初始化示例数据
```bash
cd tea_house_lite
python init_sample_data.py
```

**成功后你会看到**：
```
✅ 示例数据初始化完成！
门店数: 6
商品数: 18
会员数: 8
订单数: 20
```

### 第2步：启动系统
```bash
streamlit run app.py
```

### 第3步：打开浏览器
访问：http://localhost:8501

---

## 页面功能详解

### 1. 📊 控制台
**用途**：查看所有门店的整体运营情况

**你会看到**：
- 每个门店的今日营业额、订单数、台位状态
- 实时数据统计

**示例数据**：
- 6家门店的总营业额
- 20条订单的汇总数据

---

### 2. 🎯 经营
**用途**：日常业务操作（开台、点单、结账）

**操作流程**：

**开台**：
1. 选择门店
2. 点击空闲的桌台（绿色）
3. 选择会员（可选）
4. 点击"开台"

**点单**：
1. 点击"开台"后的桌台（黄色）
2. 选择商品
3. 输入数量
4. 点击"点单"

**结账**：
1. 在"结账"标签页
2. 查看消费明细
3. 选择支付方式（微信/支付宝/现金）
4. 输入实收金额
5. 点击"确认结账"

**自动功能**：
- ✅ 结账时自动扣减库存
- ✅ 自动记录库存出库流水

**示例数据**：
- 6家门店，每家8个桌台
- 18种商品可选
- 8名会员可关联

---

### 3. ⚙️ 设置
**用途**：基础数据管理

包含5个子页面：

#### 3.1 门店管理
**功能**：创建和管理门店

**示例数据**：
- 茶楼总店（010-88888888）
- 茶楼东城店（010-66666666）
- 茶楼西城店（010-77777777）
- 茶楼南山店（0755-99999999）
- 茶楼北湖店（027-55555555）
- 茶楼新城店（020-44444444）

#### 3.2 桌台管理
**功能**：为各门店添加桌台

**示例数据**：
- 每家门店8个桌台
- 容量：2人、4人、6人、8人桌

#### 3.3 员工管理
**功能**：管理员工信息

**示例数据**：
- 张经理（总店）
- 李店长（东城店）
- 王员工、赵员工、孙员工等

#### 3.4 商品管理
**功能**：添加商品信息

**示例数据**（18种商品）：
- **茶叶**：龙井绿茶¥68、普洱熟茶¥88、铁观音¥78、大红袍¥128、茉莉花茶¥58
- **花茶**：菊花茶¥48、玫瑰花茶¥58、柠檬茶¥38
- **零食**：瓜子¥18、花生¥18、开心果¥38、腰果¥32、话梅¥15、薯片¥12
- **菜品**：水煮鱼¥88、宫保鸡丁¥58、麻婆豆腐¥38、鱼香肉丝¥48

#### 3.5 库存管理
**功能**：库存入库

**操作流程**：
1. 选择门店
2. 选择商品
3. 输入数量
4. 输入备注（可选）
5. 点击"入库"

**自动功能**：
- ✅ 自动记录库存入库流水

---

### 4. 💎 会员管理
**用途**：会员信息管理

**示例数据**（8名会员）：
- 王先生（金卡，余额¥500）
- 李女士（钻石卡，余额¥1000）
- 张先生（银卡，余额¥300）
- 赵女士（普通卡，余额¥100）
- 陈先生（金卡，余额¥800）
- 刘女士（银卡，余额¥250）
- 黄先生（普通卡，余额¥0）
- 周女士（钻石卡，余额¥2000）

---

### 5. 📝 订单管理
**用途**：查看订单记录

**示例数据**：
- 20条已完成订单
- 涵盖不同门店和会员
- 包含多种商品组合

---

### 6. 📦 库存台账（NEW!）
**用途**：查看库存流水和库存详情

#### 6.1 库存流水标签
**功能**：查看所有库存变动记录

**筛选条件**：
- 门店（全部门店/单个门店）
- 类型（全部/入库/出库/调整）
- 日期范围

**点击查看详情**：
点击任意一条流水的"🔍 查看详情"，会显示：
- 📋 门店和商品基本信息
- 📊 变动详情（类型、数量、时间、备注）
- 📈 库存变动对比（变动前/后）
- 🛍️ 商品详细信息（编码、分类、单价）

**统计摘要**：
- 入库次数
- 出库次数
- 总变动数量

**示例数据**：
- 198条库存流水记录
- 包含入库、出库、调整记录

#### 6.2 库存详情标签
**功能**：查看各门店的库存情况

**操作流程**：
1. 选择门店
2. 查看库存列表（商品名称、编码、分类、当前库存、单价、库存价值）
3. 查看库存统计（总数量、总价值）
4. 查看库存预警（少于10件的商品）

**点击查看详情**：
点击任意商品的"🔍 查看详情"，会显示：
- 📦 商品基本信息（编码、分类、单价）
- 📋 该商品的库存流水历史（最近10条）

**示例数据**：
- 108条库存记录
- 每家门店18种商品
- 库存预警自动提示库存不足商品

---

### 7. 💰 财务报表
**用途**：查看财务和台位统计

**功能**：
- 营业额统计（按日期筛选）
- 台位统计（开台数、已结账数、平均时长）
- 台位使用情况统计

---

## 业务场景示例

### 场景1：新顾客来消费
1. 进入"🎯 经营"页面
2. 选择"茶楼总店"
3. 点击"桌台1号"（绿色=空闲）
4. 选择会员或选择"散客"
5. 点击"开台"
6. 桌台变为黄色（使用中）
7. 点击"点单"标签，选择"龙井绿茶"，数量1，点击"点单"
8. 点击"结账"标签
9. 选择"微信支付"，确认金额正确
10. 点击"确认结账"
11. 系统自动扣减库存并记录出库流水

### 场景2：查看库存流水
1. 进入"📦 库存台账"页面
2. 在"库存流水"标签中：
   - 筛选"茶楼总店"
   - 筛选类型"出库"
   - 点击任意一条记录的"🔍 查看详情"
3. 查看详细信息：
   - 门店：茶楼总店
   - 商品：龙井绿茶 (P001)
   - 变动数量：-1
   - 备注：订单 ORD20240122120000 消耗 1 件
   - 变动前：20
   - 变动后：19

### 场景3：查看商品库存历史
1. 进入"📦 库存台账" > "库存详情"标签
2. 选择"茶楼总店"
3. 找到"龙井绿茶"行
4. 点击"🔍 查看详情"
5. 显示：
   - 商品编码：P001
   - 商品分类：茶叶
   - 单价：¥68.00
   - 最近10条库存流水记录

### 场景4：库存入库
1. 进入"⚙️ 设置" > "库存管理"
2. 选择门店"茶楼总店"
3. 选择商品"龙井绿茶"
4. 输入数量：10
5. 输入备注：补货
6. 点击"入库"
7. 系统自动记录入库流水到"📦 库存台账"

### 场景5：库存预警
1. 进入"📦 库存台账" > "库存详情"标签
2. 选择任意门店
3. 查看库存预警区域
4. 系统自动显示库存少于10件的商品
5. 可以立即点击查看详情并补货

---

## 数据关系图

```
门店 (stores)
  ├── 员工 (employees)
  ├── 桌台 (tables)
  │    └── 会话 (sessions)
  │         ├── 会话明细 (session_items)
  │         └── 订单 (orders)
  │              └── 订单明细 (order_items)
  └── 库存 (inventory)
       └── 库存流水 (inventory_logs)

商品 (products)
  ├── 库存 (inventory)
  ├── 库存流水 (inventory_logs)
  ├── 会话明细 (session_items)
  └── 订单明细 (order_items)

会员 (members)
  └── 订单 (orders)
       └── 会话 (sessions)
```

---

## 常见问题

**Q: 如何重新初始化示例数据？**
A: 删除 `tea_house.db` 文件，然后运行 `python init_sample_data.py`

**Q: 库存流水在哪里查看？**
A: 进入"📦 库存台账" > "库存流水"标签

**Q: 点击库存流水可以看到什么？**
A: 可以看到该条流水的详细信息，包括门店、商品、变动详情、库存对比、商品信息

**Q: 结账时会自动扣减库存吗？**
A: 会！系统会自动扣减库存并记录出库流水到"📦 库存台账"

**Q: 库存预警的阈值是多少？**
A: 默认少于10件会触发预警

**Q: 如何查看某个商品的库存历史？**
A: 进入"📦 库存台账" > "库存详情"，点击该商品的"🔍 查看详情"

---

## 技术说明

- 数据库：SQLite（文件：tea_house.db）
- 前端：Streamlit
- ORM：SQLAlchemy
- 数据处理：Pandas

---

## 联系与支持

如有问题或建议，请查看 `README_V4.1.2.md` 获取更多信息。
